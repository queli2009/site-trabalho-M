!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).VISION=t()}(this,(function(){"use strict";const e=()=>`${Date.now()}-${Math.floor(1e13*Math.random())}`,t=(e,t)=>{const s=e.concat(t),i=s.length;let n=[7,11],a=[71,173];const r=[2277735313,289559509],o=[1291169091,658871167];for(let e=0;e<i;e++)n=[(n[0]<<5)-n[0]+s.charCodeAt(e),(n[1]<<3)-n[1]+s.charCodeAt(e)],a=[(a[0]<<4)-a[0]+s.charCodeAt(e),(a[1]<<6)-a[1]+s.charCodeAt(e)],n=[n[0]^r[0],n[1]^r[1]],a=[a[0]^o[0],a[1]^o[1]];return`00000000${(n[0]>>>0).toString(16)}`.slice(-8)+`00000000${(n[1]>>>0).toString(16)}`.slice(-8)+`00000000${(a[0]>>>0).toString(16)}`.slice(-8)+`00000000${(a[1]>>>0).toString(16)}`.slice(-8)},s=(e,t)=>!!t&&t.split(",").reduce(((e,t)=>((t=t.replace(/\(.*\)/g,"").trim())&&e.push(t),e)),[]).indexOf(e.replace(/\(.*\)/g,"").trim())>-1,i=e=>{const t=new ArrayBuffer(e.length),s=new Uint8Array(t);for(let t=0,i=e.length;t<i;t++)s[t]=e.charCodeAt(t);return t};class n{constructor(e,t){this.callback=e,this.adCount=1,this.adStartTime=0,this.adTimeSpent=0,this.previousAdTimeSpent=0,this.previousTimeSpent=0,this.startTime=0,this.timeSpent=0,t.subscribe((()=>this.config=t.getState())),this.config=t.getState()}createMediaSession(t){this.sessionId||(t.event_name=t.event_name.replace("_play","_start"),this.sessionId=e(),this.dispatch(Object.assign(Object.assign({},t),{event_name:"media_init"})))}dispatch(e,t=!1,s){let i=(t&&s?s:this.adTimeSpent)/1e3||0,n=(!t&&s?s:this.timeSpent)/1e3||0;const a=Date.now();if(t&&Math.abs(this.previousAdTimeSpent-i)>this.config.mediaAdHeartbeatSec+1)i=this.previousAdTimeSpent+this.config.mediaAdHeartbeatSec,this.adTimeSpent=1e3*i,this.adStartTime=a;else if(!t){const t=this.getHeartbeatInterval(e);Math.abs(this.previousTimeSpent-n)>t+1&&(n=this.previousTimeSpent+t,this.timeSpent=1e3*n,this.startTime=a)}this.previousAdTimeSpent=i,this.previousTimeSpent=n,this.callback(Object.assign(Object.assign({},e),{event_timestamp:a,media_ad_time_spent:i,media_session_id:this.sessionId,media_time_spent:n}))}dispatchMediaAdStop(e){const t=JSON.parse(e);t.event_name="media_ad_stop",this.dispatch(t,!0),this.adTimeSpent=0,this.previousAdTimeSpent=0,this.timeSpent=0,this.previousTimeSpent=0,this.adStartTime=0,this.sessionId=void 0}dispatchMediaStop(e){const t=JSON.parse(e);t.event_name="media_stop",this.adCount=1,this.dispatch(t),this.adTimeSpent=0,this.previousAdTimeSpent=0,this.timeSpent=0,this.previousTimeSpent=0,this.startTime=0,this.adStartTime=0,this.sessionId=void 0}getHeartbeatInterval({media_content_length:e}){return(null!=e?e:1/0)<this.config.mediaLengthShortSec?this.config.mediaHeartbeatShortSec:(null!=e?e:1/0)<this.config.mediaLengthMediumSec?this.config.mediaHeartbeatMediumSec:this.config.mediaHeartbeatLongSec}handleEvent(e){const t=Date.now();switch(e.event_name){case"media_ad_pause":if(!this.sessionId)return;window.clearInterval(this.adHeartbeatIntervalId),this.setAdPauseTimeout(e),this.adTimeSpent+=t-this.adStartTime,this.adStartTime=0,this.dispatch(e,!0);break;case"media_ad_play":window.clearTimeout(this.adPauseTimeoutId),this.createMediaSession(e),this.setAdHeartbeatInterval(e),this.adStartTime=t,this.dispatch(e,!0);break;case"media_ad_skipped":if(!this.sessionId)return;window.clearInterval(this.adHeartbeatIntervalId),window.clearTimeout(this.adPauseTimeoutId),this.timeSpent>0&&(this.setHeartbeatInterval(e),this.startTime=t),this.adCount+=1,this.adStartTime>0&&(this.adTimeSpent+=t-this.adStartTime),this.dispatch(e,!0),this.dispatch(Object.assign(Object.assign({},e),{event_name:"media_ad_stop"}),!0),this.adStartTime=0;break;case"media_ad_start":this.createMediaSession(e),this.setAdHeartbeatInterval(e),this.startTime>0&&(window.clearInterval(this.heartbeatIntervalId),this.timeSpent+=t-this.startTime,this.startTime=0),this.adStartTime=t,this.dispatch(e,!0);break;case"media_ad_stop":if(!this.sessionId)return;window.clearInterval(this.adHeartbeatIntervalId),window.clearTimeout(this.adPauseTimeoutId),this.timeSpent>0&&(this.setHeartbeatInterval(e),this.startTime=t),this.adCount+=1,this.adStartTime>0&&(this.adTimeSpent+=t-this.adStartTime),this.dispatch(e,!0),this.adStartTime=0;break;case"media_backward":if(!this.sessionId||0===this.startTime)return;this.timeSpent+=t-this.startTime,this.startTime=t,this.dispatch(e);break;case"media_buffer_end":case"media_buffer_start":case"media_forward":if(!this.sessionId)return;this.timeSpent+=t-this.startTime,this.startTime=t,this.dispatch(e);break;case"media_dispose_ad_stop":if(window.clearInterval(this.adHeartbeatIntervalId),window.clearInterval(this.heartbeatIntervalId),window.clearTimeout(this.adPauseTimeoutId),0===this.adStartTime)return;e.event_name="media_ad_stop",this.adCount+=1,this.adTimeSpent+=t-this.adStartTime,this.dispatch(e,!0),this.adTimeSpent=0,this.previousAdTimeSpent=0,this.timeSpent=0,this.previousTimeSpent=0,this.startTime=0,this.sessionId=void 0;break;case"media_pause":if(!this.sessionId||0===this.startTime)return;window.clearInterval(this.heartbeatIntervalId),this.setPauseTimeout(e),this.timeSpent+=t-this.startTime,this.startTime=0,this.dispatch(e);break;case"media_play":window.clearTimeout(this.pauseTimeoutId),this.createMediaSession(e),this.setHeartbeatInterval(e),this.startTime=t,this.dispatch(e);break;case"media_start":this.createMediaSession(e),this.setHeartbeatInterval(e),this.startTime=t,this.dispatch(e);break;case"media_stop":if(window.clearInterval(this.heartbeatIntervalId),window.clearTimeout(this.pauseTimeoutId),!this.sessionId)return;this.startTime>0&&(this.timeSpent+=t-this.startTime),this.adCount=1,this.dispatch(e),this.adTimeSpent=0,this.previousAdTimeSpent=0,this.timeSpent=0,this.previousTimeSpent=0,this.startTime=0,this.sessionId=void 0}}setAdHeartbeatInterval(e){window.clearInterval(this.adHeartbeatIntervalId);const t=JSON.stringify(e);this.adHeartbeatIntervalId=window.setInterval((()=>{const e=JSON.parse(t),s=Date.now()-this.adStartTime+this.adTimeSpent;e.event_name="media_ad_heartbeat",e.media_current_position=void 0,s>12e4*this.adCount?(window.clearInterval(this.adHeartbeatIntervalId),this.adTimeSpent=s,this.dispatchMediaAdStop(t)):this.dispatch(e,!0,s)}),1e3*this.config.mediaAdHeartbeatSec)}setAdPauseTimeout(e){window.clearTimeout(this.adPauseTimeoutId),this.adPauseTimeoutId=window.setTimeout((()=>this.dispatchMediaAdStop(JSON.stringify(e))),1e3*this.config.mediaPauseTimeoutSec)}setHeartbeatInterval(e){window.clearInterval(this.heartbeatIntervalId);const t=JSON.stringify(e);this.heartbeatIntervalId=window.setInterval((()=>{const e=JSON.parse(t),s=Date.now()-this.startTime+this.timeSpent;e.event_name="media_heartbeat",e.media_current_position=void 0,e.media_content_length&&s>2*e.media_content_length*1e3?(window.clearInterval(this.heartbeatIntervalId),this.timeSpent=s,this.dispatchMediaStop(t)):this.dispatch(e,!1,s)}),1e3*this.getHeartbeatInterval(e))}setPauseTimeout(e){window.clearTimeout(this.pauseTimeoutId),this.pauseTimeoutId=window.setTimeout((()=>this.dispatchMediaStop(JSON.stringify(e))),1e3*this.config.mediaPauseTimeoutSec)}}const a=e=>r(e)&&"event_name"in e,r=e=>"object"==typeof e&&null!=e&&!Array.isArray(e),o=e=>!isNaN(e)&&e instanceof Date,c={ad_id:"ad1",ad_creative:"ad2",ad_type:"ad3",ad_placement:"ad4",ad_orientation:"ad6",ad_destination_url:"ad7",ad_version:"ad8",ad_parent_type:"ad9",ad_parent_id:"ad10",ad_pod_number:"ad11",ad_pod_size:"ad12",api_url:"ap1",api_method:"ap2",api_response_time:"ap3",article_id:"ar1",article_id_source:"ar2",article_name:"ar3",event_name:"e2",event_instance_id:["e3",!0],event_session_sequence_num:["e4",!0],event_timestamp:"e6",event_log_timestamp:["e7",!0],event_test:"e10",funnel_type:"fn1",funnel_name:"fn2",funnel_milestone:"fn3",impression_id:"imp1",impression_id_source:"imp2",impression_type:"imp3",link_module_name:"l1",link_module_position:"l2",link_name:"l4",link_position:"l5",link_destination_location:"l7",link_destination_url:"l8",media_id:"m1",media_id_source:"m2",media_name:"m3",media_observed_bitrate:"m5",media_content_length:"m6",media_current_position:"m7",media_current_chapter:"m8",media_player_name:"m9",media_player_type:"m10",media_player_version:"m11",media_session_id:"m12",media_subtitle_language:"m16",media_video_type:"m20",media_ad_id:"m26",media_ad_id_source:"m27",media_time_spent:"m28",media_ad_time_spent:"m29",media_live:"m30",media_viewing_mode:"m31",media_channel:"m32",media_air_date:"m33",media_air_time:"m34",media_airing_id:"m35",media_program_code:"m36",media_segment:"m37",media_start_type:"m40",media_network_name:"m41",media_is_mute:"m42",media_live_scoring:"m43",media_autoplay_sound:"m45",media_video_type_detail:"m46",media_show_code:"m47",media_play_location:"m48",media_binge_play_count:"m53",page_location:["p1",!1,!0],page_url:["p2",!1,!0],page_id:["p3",!1,!0],page_id_source:["p4",!1,!0],page_instance_id:["p5",!1,!0],page_previous_url:["p6",!0,!0],page_z_axis:"p7",page_version:"p8",page_type:["p9",!1,!0],page_time_spent:"p10",page_user_mode:"p11",page_auth_flag:"p12",page_nav_method:"p13",page_premium_content:"p14",pzncon_event:"pc1",pzncon_personalized:"pc2",pzncon_curated:"pc3",pzncon_reason:"pc4",pzncon_rule:"pc5",pzncon_edition:"pc6",pzncon_slot_position:"pc7",pzncon_presentation_type:"pc8",pzncon_content_id:"pc9",pzncon_content_id_type:"pc10",pzncon_nav_method:"pc11",pzncon_clubhouse:"pc12",pzncon_feed_version:"pc13",pzncon_content_score:"pc14",pzncon_entitled:"pc15",pzncon_collection_id:"pc16",pzncon_collection_id_type:"pc17",pzncon_personal_metadata:"pc18",pzncon_originally_published:"pc19",pzncon_last_modified:"pc20",pzncon_content_title:"pc21",pzncon_personal_metadata_ids:"pc22",pzncon_premium:"pc23",pzncol_collection_id:"pcl1",pzncol_collection_id_type:"pcl2",pzncol_content_id:"pcl3",pznfav_event:"pf1",pznfav_entity_id:"pf2",pznfav_entity_type:"pf3",state_cmp:["s1",!1,!0],state_test:["s2",!1,!0],state_orientation:["s3",!0],session_id:["se1",!0],session_language:["se2",!0],session_first_page:["se3",!0],session_first_url:["se4",!0],session_first_referrer_url:["se5",!0],session_start_timestamp:["se9",!0],session_total_time:["se10",!0],search_module:"sr1",search_type:"sr2",search_keyword_executed:"sr3",search_keyword_typed:"sr4",search_refinement:"sr5",search_results_count:"sr6"},d={app_bundle_id:["a1",!0],app_suite:["a2",!0],app_platform:["a3",!0],app_version:["a4",!0],app_logging_lib_version:["a5",!0],app_region:["a6",!0],app_country:["a7",!0],app_network:["a8",!0],app_zipcode:["a10",!0],app_id:["a11",!0],browser_height:["br2",!0],browser_width:["br3",!0],browser_cookies_flag:["br4",!0],browser_local_storage_flag:["br5",!0],browser_java_flag:["br6",!0],browser_plugins:["br8",!0],browser_flash_version:["br9",!0],device_height:["d5",!0],device_width:["d6",!0],device_advertiser_id:["d13",!0,!0],user_guest_id:["u1",!0],user_affiliate:["u2",!0,!0],user_mvpd_short_name:["u3",!0,!0],user_mvpd_name:["u4",!0,!0],user_subscriber_type:["u5",!0,!0],user_access_method:["u6",!0,!0],user_disney_plus_bundle:["u7",!0,!0],user_anonymous_id:["u8",!0],user_subscription_id:["u9",!0,!0],user_dss_id:["u10",!0,!0]},l=[{name:"app_country"},{name:"app_region"},{name:"app_zipcode"},{name:"device_advertiser_id"},{name:"session_language"},{name:"user_affiliate"},{name:"user_anonymous_id"},{name:"user_dss_id"},{name:"user_guest_id"},{name:"user_subscription_id",properties:["id"]}],h={collection:!0,compression:"none",disableAppVersions:"",disableMediaAppVersions:"",disableMediaSdkVersions:"",disableSdkVersions:"",flushAtEventCount:10,flushIntervalSec:60,mediaAdHeartbeatSec:5,mediaCollection:!0,mediaHeartbeatLongSec:20,mediaHeartbeatMediumSec:10,mediaHeartbeatShortSec:5,mediaLengthMediumSec:3600,mediaLengthShortSec:90,mediaPauseTimeoutSec:600,pageActiveThreshold:120,pageHeartbeatCollection:!1,pageHeartbeatInSeconds:60,pollConfigIntervalSec:600,privacy:!1,privacyProperties:l},u={app_bundle_id:"",app_id:"",app_platform:"",app_suite:"",app_version:"",guestIds:[],lastHeartbeat:0,libVersion:"12.1.0",url:""},p="vision";class _{constructor(){this.events={}}publish(e,...t){var s;null===(s=this.events[e])||void 0===s||s.forEach((e=>e(...t)))}subscribe(e,t){Array.isArray(this.events[e])||(this.events[e]=[]),this.events[e].push(t);const s=this.events[e].length-1;return()=>this.events[e].splice(s,1)}}class v{constructor(e){this.store=e}log(e,t="Debug"){this.store.getState().debugMode&&console.log(`VISION Log (${t}):`,e)}}class m{constructor(e,t,s,i){this.eventBus=e,this.storage=t,this.store=s,this.lastEvent=0,e.subscribe("client.unset-force-disable-collection",(()=>this.create())),i.subscribe((()=>{this.config=i.getState();const{pageHeartbeatInSeconds:e}=this;this.pageHeartbeatInSeconds=this.config.pageHeartbeatInSeconds,null!=this.heartbeatIntervalId&&e!==this.pageHeartbeatInSeconds&&this.setHeartbeatInterval()})),this.config=i.getState(),this.pageHeartbeatInSeconds=this.config.pageHeartbeatInSeconds}create(){const t=Date.now(),s={active:t+18e5,event_session_sequence_num:0,expires:t+432e5,session_id:e(),session_start_timestamp:t,session_total_time:0,vision_id:e()};return this.storage.setLocalItem("visionSession",s),s}createAnonId(){const t={expires:Date.now()+33927469800,user_anonymous_id:e()};return this.storage.setLocalItem("visionAnonId",t),t}extend(){const e=this.readOrCreate(),t=Date.now();e.expires-t>0&&e.active-t>0?this.storage.setLocalItem("visionSession",Object.assign(Object.assign({},e),{active:t+18e5})):this.create()}readOrCreate(){const e=this.storage.getLocalItem("visionSession");return null!=e?e:this.create()}readOrCreateAnonId(){const e=this.storage.getLocalItem("visionAnonId");return null!=e&&e.expires-Date.now()>0?e:this.createAnonId()}run(){this.eventBus.subscribe("tracking.activity",(()=>{this.extend(),this.touchLastEvent()})),this.eventBus.subscribe("tracking.page",(e=>this.updatePageProperties(e))),window.addEventListener("pagehide",(()=>this.updateTimeSpent())),window.document.addEventListener("scroll",(()=>this.touchLastEvent())),this.setHeartbeatInterval(),this.readOrCreateAnonId(),this.extend(),this.touchLastEvent(),this.store.setState({lastHeartbeat:Date.now()})}setHeartbeatInterval(){window.clearInterval(this.heartbeatIntervalId),this.heartbeatIntervalId=window.setInterval((()=>{this.updateTimeSpent((()=>{Date.now()-this.lastEvent<1e3*this.config.pageActiveThreshold?this.config.pageHeartbeatCollection&&this.eventBus.publish("session.page-heartbeat"):(this.eventBus.publish("session.page-close"),this.lastEvent=0)}))}),1e3*this.config.pageHeartbeatInSeconds)}touchLastEvent(){this.lastEvent=Date.now()}update(e){const t=this.readOrCreate(),s=Object.keys(e).reduce(((s,i)=>{const n=e[i];return s[i]="function"==typeof n?n(t[i]):n,s}),{});this.storage.setLocalItem("visionSession",Object.assign(Object.assign({},t),s))}updatePageProperties(e){const t=this.storage.getLocalItem("visionSession"),s={};if(!(null==t?void 0:t.session_first_referrer_url)){const e=this.storage.getSessionItem("visionPagePreviousUrl");e&&(s.session_first_referrer_url=e)}if(e.page_location&&!(null==t?void 0:t.session_first_page)&&(s.session_first_page=e.page_location),e.page_url&&!(null==t?void 0:t.session_first_url)&&(s.session_first_url=e.page_url),Object.keys(s).length>0&&this.update(s),"page_view"===e.event_name&&e.page_url){const e=this.storage.getSessionItem("visionPageUrl");e&&this.storage.setSessionItem("visionPagePreviousUrl",e)}}updateTimeSpent(e){const t=Date.now(),s=t-this.store.getState().lastHeartbeat;this.lastEvent>0&&s>0&&s<=1.1*this.config.pageHeartbeatInSeconds*1e3&&(null==e||e(),this.update({session_total_time:e=>e+s/1e3})),this.store.setState({lastHeartbeat:t})}}class g{constructor(){this.memo={},this.getLocalItem=g.createGetter("localStorage"),this.getSessionItem=g.createGetter("sessionStorage"),this.removeLocalItem=g.createRemover("localStorage"),this.removeSessionItem=g.createRemover("sessionStorage"),this.setLocalItem=g.createSetter("localStorage"),this.setSessionItem=g.createSetter("sessionStorage")}static createGetter(e){return function(t){if(!this.isAvailable(e))return null;try{return JSON.parse(window[e].getItem(t))}catch(e){}return null}}static createRemover(e){return function(t){this.isAvailable(e)&&window[e].removeItem(t)}}static createSetter(e){return function(t,s){if(!this.isAvailable(e))return;const i=JSON.stringify(s);void 0!==i&&window[e].setItem(t,i)}}isAvailable(e){if(null==this.memo[e])try{const t=window[e],s="__storage_test__";t.setItem(s,s),t.removeItem(s),this.memo[e]=!0}catch(t){this.memo[e]=!1}return this.memo[e]}}class f{constructor(e){this.initialState=e,this.listeners=new Set,this.state=e}getInitialState(){return this.initialState}getState(){return this.state}setState(e,t){const s="function"==typeof e?e(this.state):e;if(s===this.state)return;const i=this.state;this.state=(null!=t?t:!r(s))?s:Object.assign(Object.assign({},this.state),s),this.listeners.forEach((e=>e(this.state,i)))}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}}const S=()=>{const e=window.navigator.plugins["Shockwave Flash 2.0"]||window.navigator.plugins["Shockwave Flash"],t=window.navigator.userAgent.toLowerCase();return`flash_version:${e?(e=>{const t=e.description.split(" "),[s,i]=t[2].split("."),n=""!==t[3]?t[3]:t[4];return[s,i,"d"===n[0]?n.slice(1):"r"===n[0]?n.replace(/^r(.?[^d]*).*/,"$1"):n].join(".")})(e):t.indexOf("webtv/2.6")>-1?"4":t.indexOf("webtv/2.5")>-1?"3":t.indexOf("webtv")>-1?"2":b()?(()=>{try{return new window.ActiveXObject("ShockwaveFlash.ShockwaveFlash.7").GetVariable("$version")}catch(e){}try{const e=new window.ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");return e.AllowScriptAccess="always",e.GetVariable("$version")}catch(e){}try{return new window.ActiveXObject("ShockwaveFlash.ShockwaveFlash.6"),"WIN 6,0,21,0"}catch(e){}try{return new window.ActiveXObject("ShockwaveFlash.ShockwaveFlash.3").GetVariable("$version")}catch(e){}try{return new window.ActiveXObject("ShockwaveFlash.ShockwaveFlash.3"),"WIN 3,0,18,0"}catch(e){}try{return new window.ActiveXObject("ShockwaveFlash.ShockwaveFlash"),"WIN 2,0,0,11"}catch(e){}return"-1"})():"-1"}`},b=()=>window.navigator.appVersion.indexOf("MSIE")>-1&&window.navigator.appVersion.toLowerCase().indexOf("win")>-1&&-1===window.navigator.userAgent.indexOf("Opera");class w{constructor(e,t,s){this.storage=e,this.store=t,s.subscribe((()=>this.config=s.getState())),this.config=s.getState()}app_bundle_id(){return this.store.getState().app_bundle_id}app_country(){return this.store.getState().app_country}app_id(){return this.store.getState().app_id}app_logging_lib_version(){return this.store.getState().libVersion}app_network(){return this.store.getState().app_network}app_platform(){return this.store.getState().app_platform}app_region(){return this.store.getState().app_region}app_suite(){return this.store.getState().app_suite}app_version(){return this.store.getState().app_version}app_zipcode(){return this.store.getState().app_zipcode}browser_cookies_flag(){return window.navigator.cookieEnabled}browser_flash_version(){return S()}browser_height(){return Math.floor(window.innerHeight||window.document.body.clientHeight)}browser_local_storage_flag(){return this.storage.isAvailable("localStorage")}browser_java_flag(){return"function"==typeof window.navigator.javaEnabled&&window.navigator.javaEnabled()}browser_plugins(){var e;if(null!=(null===(e=window.navigator.plugins)||void 0===e?void 0:e.length))return Array.prototype.map.call(window.navigator.plugins,(e=>e.name)).join(";")}browser_width(){return Math.floor(window.innerWidth||window.document.body.clientWidth)}device_height(){return Math.floor(window.screen.height)}device_width(){return Math.floor(window.screen.width)}event_instance_id(){return e()}event_log_timestamp(){return Date.now()}event_session_sequence_num(){const e=this.storage.getLocalItem("visionSession");if(null!=e)return e.event_session_sequence_num+=1,this.storage.setLocalItem("visionSession",e),e.event_session_sequence_num}event_timestamp(e){return(null==e?void 0:e.event_timestamp)||Date.now()}pzncon_last_modified(e){const t=new Date(null==e?void 0:e.pzncon_last_modified);return o(t)?t.getTime():void 0}pzncon_originally_published(e){const t=new Date(null==e?void 0:e.pzncon_originally_published);return o(t)?t.getTime():void 0}session_first_page(){var e;return null===(e=this.storage.getLocalItem("visionSession"))||void 0===e?void 0:e.session_first_page}session_first_referrer_url(){var e;return null===(e=this.storage.getLocalItem("visionSession"))||void 0===e?void 0:e.session_first_referrer_url}session_first_url(){var e;return null===(e=this.storage.getLocalItem("visionSession"))||void 0===e?void 0:e.session_first_url}session_id(){var e;return null===(e=this.storage.getLocalItem("visionSession"))||void 0===e?void 0:e.session_id}session_language(){return window.navigator.language||window.navigator.browserLanguage}session_start_timestamp(){var e;return null===(e=this.storage.getLocalItem("visionSession"))||void 0===e?void 0:e.session_start_timestamp}session_total_time(){var e;const t=Date.now()-this.store.getState().lastHeartbeat,s=t>0&&t<=1.1*this.config.pageHeartbeatInSeconds*1e3,i=(null===(e=this.storage.getLocalItem("visionSession"))||void 0===e?void 0:e.session_total_time)||0;return s?i+t/1e3:i}state_cmp(e){return(null==e?void 0:e.state_cmp)||(t="cmp",window.document.location.search.slice(1).split("&").reduce(((e,s)=>{const[i,n]=s.split("=");return null!=e||i!==t?e:null==n?"":decodeURIComponent(n)}),void 0));var t}state_orientation(){return window.matchMedia("(orientation: landscape)").matches?"landscape":"portrait"}user_anonymous_id(){var e;return null===(e=this.storage.getLocalItem("visionAnonId"))||void 0===e?void 0:e.user_anonymous_id}user_guest_id(){return this.store.getState().guestIds.map((e=>Object.assign({},e)))}}class I{constructor(e,t,s,i,n){this.eventBus=e,this.storage=t,this.store=s,this.xhr=i,n.subscribe((()=>{this.config=n.getState();const{flushIntervalSec:e}=this;this.flushIntervalSec=this.config.flushIntervalSec,null!=this.flushIntervalId&&e!==this.flushIntervalSec&&this.setFlushInterval()})),this.config=n.getState(),this.flushIntervalSec=this.config.flushIntervalSec,this.trackingModel=new w(t,s,n)}anonymize(e){var t;const s=this.isValidPrivacyProperties(this.config.privacyProperties)?this.config.privacyProperties:l,i=e=>{s.forEach((({name:t,properties:s})=>{const i=e[t];void 0!==i&&(Array.isArray(s)?Array.isArray(i)?i.forEach((e=>n(e,s))):n(i,s):void 0===s&&delete e[t])}))};function n(e,t){r(e)&&t.forEach((t=>delete e[t]))}i(null!==(t=e.global)&&void 0!==t?t:e),e.events.forEach((e=>{e.state_privacy=!0,i(e)}))}batchEvents(e){(e=[...(this.storage.getLocalItem("visionEvents")||[]).filter(this.isEventData),...e]).length>=this.config.flushAtEventCount?(this.xhr.postEvents(this.createPayload(e)),this.storage.removeLocalItem("visionEvents")):this.storage.setLocalItem("visionEvents",e)}createEventData(e){const t=this.storage.getSessionItem("visionCustomEventProperties");return e.map((e=>this.mapProperties(c,Object.assign(Object.assign({},e),t))))}createPayload(e){const t=this.storage.getSessionItem("visionCustomGlobalProperties"),s=this.mapProperties(d,t),i=this.store.getState().experimentalPartiallyFlatten?Object.assign(Object.assign({},s),{events:e}):{events:e,global:s};return(this.config.privacy||this.storage.getSessionItem("visionStatePrivacy"))&&this.anonymize(i),i}handleEvents(e){if(this.isCollectionDisabled())return;const{eventsToBatch:t,eventsToPost:s,isActivity:i}=e.reduce(((e,t)=>{if(/^media_/.test(t.event_name))return e;this.eventBus.publish("tracking.page",t);const s="pzncon"===t.event_name?"eventsToBatch":"eventsToPost";return e.isActivity=e.isActivity||-1===["page_close","page_heartbeat"].indexOf(t.event_name),e[s].push(t),e}),{eventsToBatch:[],eventsToPost:[],isActivity:!1});i&&this.eventBus.publish("tracking.activity"),s.length>0&&this.xhr.postEvents(this.createPayload(this.createEventData(s))),t.length>0&&this.batchEvents(this.createEventData(t))}isCollectionDisabled(){return!this.config.collection||s(this.store.getState().libVersion,this.config.disableSdkVersions)||s(this.store.getState().app_version,this.config.disableAppVersions)||!!this.storage.getLocalItem("visionForceDisableCollection")}isEventData(e){return r(e)&&"event_name"in e}isMediaCollectionDisabled(){return!this.config.mediaCollection||s(this.store.getState().libVersion,this.config.disableMediaSdkVersions)||s(this.store.getState().app_version,this.config.disableMediaAppVersions)||this.isCollectionDisabled()}isValidPrivacyProperties(e){return Array.isArray(e)&&!!e.length&&e.every((e=>r(e)&&"name"in e))}mapProperties(e,t){const s=t?Object.keys(t):[],i=[...new Set([...Object.keys(e),...s])],n=e=>this.store.getState().removeEmptyValues?(e=>null==e||""===e||"null"===e||"undefined"===e||"object"==typeof e&&0===Object.keys(e).length)(e):void 0===e;return i.reduce(((s,i)=>{var r;const o=e[i],[,c,d]=Array.isArray(o)?o:[o,!1];let l=c||null==t?void 0:t[i];if("function"==typeof this.trackingModel[i]&&(l=this.trackingModel[i](a(t)?t:void 0)),d){const e=`vision${(e=>e.split("_").map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join(""))(i)}`;n(l)?l=null!==(r=this.storage.getSessionItem(e))&&void 0!==r?r:void 0:this.storage.setSessionItem(e,l)}return n(l)||(s[i]=l),s}),{})}postBatch(){const e=(this.storage.getLocalItem("visionEvents")||[]).filter(this.isEventData);e.length&&!this.isCollectionDisabled()&&(this.xhr.postEvents(this.createPayload(e)),this.storage.removeLocalItem("visionEvents"))}postMedia(e){this.isMediaCollectionDisabled()||(this.eventBus.publish("tracking.page",e),this.eventBus.publish("tracking.activity"),this.xhr.postEvents(this.createPayload(this.createEventData([e])),!0))}run(){this.eventBus.subscribe("session.page-close",(()=>this.handleEvents([{event_name:"page_close"}]))),this.eventBus.subscribe("session.page-heartbeat",(()=>this.handleEvents([{event_name:"page_heartbeat"}]))),this.setFlushInterval()}setFlushInterval(){window.clearInterval(this.flushIntervalId),this.flushIntervalId=window.setInterval((()=>this.postBatch()),1e3*this.flushIntervalSec)}}function y(e,t,s,i){return new(s||(s=Promise))((function(n,a){function r(e){try{c(i.next(e))}catch(e){a(e)}}function o(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,o)}c((i=i.apply(e,t||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;const T=new g;class A{constructor(e,t){if(this._activated=!1,this._fetchIntervalSec=600,this._fetchTimestamp=-1,this._lastFetchStatus="no-fetch-yet","object"!=typeof e||null==e)throw new TypeError("VISION Configurator: default config argument is invalid");if("object"!=typeof t&&null!=t)throw new TypeError("VISION Configurator: settings argument is invalid");const{fetchIntervalSec:s,sdk:i,url:n}=null!=t?t:{};this._settings={debug:!!(null==t?void 0:t.debug),sdk:"",url:""},this._store=new f(e),"number"==typeof s&&(this._fetchIntervalSec=s>60?s:60),"string"==typeof i&&(this._settings.sdk=i),"string"==typeof n&&/^https?:\/\//.test(n)&&(this._settings.url=n),this._promise=new Promise((e=>this._resolve=e)).then((()=>{this._activated=!0}))}get activated(){return this._activated}get defaultConfig(){return this._store.getInitialState()}ensureActivated(){return y(this,void 0,void 0,(function*(){yield this._promise}))}fetchConfig(){return y(this,void 0,void 0,(function*(){var e;if(null!=this._fetchIntervalId)return;if(!this._validates())return void console.error(new Error("VISION Configurator: settings are invalid"));this._store.subscribe((e=>{const{_fetchIntervalSec:t}=this,s="pollConfigIntervalSec"in e?e.pollConfigIntervalSec:void 0;"number"==typeof s&&(this._fetchIntervalSec=s>60?s:60),null!=this._fetchIntervalId&&t!==this._fetchIntervalSec&&this._setFetchInterval()}));const t=T.getLocalItem(`${this._settings.sdk}ConfigTimestamp`);if("number"==typeof t&&(Date.now()-t)/1e3<this._fetchIntervalSec){const t=T.getLocalItem(`${this._settings.sdk}Configuration`)||{};this._store.setState(Object.assign(Object.assign({},this._store.getInitialState()),t),!0),null===(e=this._resolve)||void 0===e||e.call(this)}else yield this._fetchRemote();this._setFetchInterval()}))}_fetchRemote(){return y(this,arguments,void 0,(function*(e=!0){var s,i,n;if(!T.getLocalItem("visionForceDisableCollection"))if(this._validates())try{let e;if(this._settings.url.startsWith("https://vision.fn-pz")){const i=(null===(s=T.getLocalItem("visionSession"))||void 0===s?void 0:s.session_id)||"";e={credentials:"include",headers:{Authorization:t(i,p),"Session-Id":i}}}const a=yield window.fetch(this._settings.url,e),r=a.ok?null===(i=yield a.json())||void 0===i?void 0:i.config:void 0;if(!a.ok)throw new Error(yield a.text());if("object"!=typeof r||null==r)throw new TypeError("config is invalid");this._lastFetchStatus="success",this._fetchTimestamp=Date.now(),T.setLocalItem(`${this._settings.sdk}ConfigTimestamp`,this._fetchTimestamp),T.setLocalItem(`${this._settings.sdk}Configuration`,r),this._store.setState(Object.assign(Object.assign({},this._store.getInitialState()),r),!0),this._activated||null===(n=this._resolve)||void 0===n||n.call(this),this._settings.debug&&console.log("VISION Configurator:",r)}catch(t){if(e)return void(yield this._fetchRemote(!1));this._lastFetchStatus="failure",this._settings.debug&&console.log("VISION Configurator:",t)}else console.error(new Error("VISION Configurator: settings are invalid"))}))}get fetchTimestamp(){return this._fetchTimestamp}getAll(){return this._store.getState()}getValue(e){return this._store.getState()[e]}get lastFetchStatus(){return this._lastFetchStatus}_setFetchInterval(){window.clearInterval(this._fetchIntervalId),this._fetchIntervalId=window.setInterval((()=>this._fetchRemote()),1e3*this._fetchIntervalSec)}get settings(){return this._settings}get store(){return this._store}subscribe(e){return this._store.subscribe(e)}_validates(){const{sdk:e,url:t}=this._settings;return"string"==typeof e&&!!e&&"string"==typeof t&&/^https?:\/\//.test(t)}}var k,E={},C={};function O(){if(k)return C;k=1;var e=[0,255,65535,16777215,4294967295];function t(e,t,s,i,n){var a;for(a=0;a<n;a++)s[i+a]=e[t+a]}function s(e,t,s,i){var n;for(n=0;n<i;n++)e[t+n]=e[t-s+n]}function i(e){this.array=e,this.pos=0}return i.prototype.readUncompressedLength=function(){for(var e,t,s=0,i=0;i<32&&this.pos<this.array.length;){if(e=this.array[this.pos],this.pos+=1,(t=127&e)<<i>>>i!==t)return-1;if(s|=t<<i,e<128)return s;i+=7}return-1},i.prototype.uncompressToBuffer=function(i){for(var n,a,r,o,c=this.array,d=c.length,l=this.pos,h=0;l<c.length;)if(n=c[l],l+=1,3&n){switch(3&n){case 1:a=4+(n>>>2&7),o=c[l]+(n>>>5<<8),l+=1;break;case 2:if(l+1>=d)return!1;a=1+(n>>>2),o=c[l]+(c[l+1]<<8),l+=2;break;case 3:if(l+3>=d)return!1;a=1+(n>>>2),o=c[l]+(c[l+1]<<8)+(c[l+2]<<16)+(c[l+3]<<24),l+=4}if(0===o||o>h)return!1;s(i,h,o,a),h+=a}else{if((a=1+(n>>>2))>60){if(l+3>=d)return!1;r=a-60,a=1+((a=c[l]+(c[l+1]<<8)+(c[l+2]<<16)+(c[l+3]<<24))&e[r]),l+=r}if(l+a>d)return!1;t(c,l,i,h,a),l+=a,h+=a}return!0},C.SnappyDecompressor=i,C}var P,H,M={};var D,L=function(){if(H)return E;function e(){return"object"==typeof process&&"object"==typeof process.versions&&void 0!==process.versions.node}function t(t){return t instanceof Uint8Array&&(!e()||!Buffer.isBuffer(t))}function s(e){return e instanceof ArrayBuffer}function i(t){return!!e()&&Buffer.isBuffer(t)}H=1;var n=O().SnappyDecompressor,a=function(){if(P)return M;P=1;var e=new Array(15);function t(e,t){return 506832829*e>>>t}function s(e,t){return e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24)}function i(e,t,s){return e[t]===e[s]&&e[t+1]===e[s+1]&&e[t+2]===e[s+2]&&e[t+3]===e[s+3]}function n(e,t,s,i,n){return s<=60?(i[n]=s-1<<2,n+=1):s<256?(i[n]=240,i[n+1]=s-1,n+=2):(i[n]=244,i[n+1]=s-1&255,i[n+2]=s-1>>>8,n+=3),function(e,t,s,i,n){var a;for(a=0;a<n;a++)s[i+a]=e[t+a]}(e,t,i,n,s),n+s}function a(e,t,s,i){return i<12&&s<2048?(e[t]=1+(i-4<<2)+(s>>>8<<5),e[t+1]=255&s,t+2):(e[t]=2+(i-1<<2),e[t+1]=255&s,e[t+2]=s>>>8,t+3)}function r(e,t,s,i){for(;i>=68;)t=a(e,t,s,64),i-=64;return i>64&&(t=a(e,t,s,60),i-=60),a(e,t,s,i)}function o(a,o,c,d,l){for(var h=1;1<<h<=c&&h<=14;)h+=1;var u=32-(h-=1);void 0===e[h]&&(e[h]=new Uint16Array(1<<h));var p,_=e[h];for(p=0;p<_.length;p++)_[p]=0;var v,m,g,f,S,b,w,I,y,T,A=o+c,k=o,E=o,C=!0;if(c>=15)for(v=A-15,g=t(s(a,o+=1),u);C;){b=32,f=o;do{if(m=g,w=b>>>5,b+=1,f=(o=f)+w,o>v){C=!1;break}g=t(s(a,f),u),S=k+_[m],_[m]=o-k}while(!i(a,o,S));if(!C)break;l=n(a,E,o-E,d,l);do{for(I=o,y=4;o+y<A&&a[o+y]===a[S+y];)y+=1;if(o+=y,l=r(d,l,I-S,y),E=o,o>=v){C=!1;break}_[t(s(a,o-1),u)]=o-1-k,S=k+_[T=t(s(a,o),u)],_[T]=o-k}while(i(a,o,S));if(!C)break;g=t(s(a,o+=1),u)}return E<A&&(l=n(a,E,A-E,d,l)),l}function c(e){this.array=e}return c.prototype.maxCompressedLength=function(){var e=this.array.length;return 32+e+Math.floor(e/6)},c.prototype.compressToBuffer=function(e){var t,s=this.array,i=s.length,n=0,a=0;for(a=function(e,t,s){do{t[s]=127&e,(e>>>=7)>0&&(t[s]+=128),s+=1}while(e>0);return s}(i,e,a);n<i;)a=o(s,n,t=Math.min(i-n,65536),e,a),n+=t;return a},M.SnappyCompressor=c,M}().SnappyCompressor,r="Argument compressed must be type of ArrayBuffer, Buffer, or Uint8Array";return E.uncompress=function(e,a){if(!t(e)&&!s(e)&&!i(e))throw new TypeError(r);var o=!1,c=!1;t(e)?o=!0:s(e)&&(c=!0,e=new Uint8Array(e));var d,l,h=new n(e),u=h.readUncompressedLength();if(-1===u)throw new Error("Invalid Snappy bitstream");if(u>a)throw new Error(`The uncompressed length of ${u} is too big, expect at most ${a}`);if(o){if(d=new Uint8Array(u),!h.uncompressToBuffer(d))throw new Error("Invalid Snappy bitstream")}else if(c){if(d=new ArrayBuffer(u),l=new Uint8Array(d),!h.uncompressToBuffer(l))throw new Error("Invalid Snappy bitstream")}else if(d=Buffer.alloc(u),!h.uncompressToBuffer(d))throw new Error("Invalid Snappy bitstream");return d},E.compress=function(e){if(!t(e)&&!s(e)&&!i(e))throw new TypeError(r);var n=!1,o=!1;t(e)?n=!0:s(e)&&(o=!0,e=new Uint8Array(e));var c,d,l,h=new a(e),u=h.maxCompressedLength();if(n?(c=new Uint8Array(u),l=h.compressToBuffer(c)):o?(c=new ArrayBuffer(u),d=new Uint8Array(c),l=h.compressToBuffer(d)):(c=Buffer.alloc(u),l=h.compressToBuffer(c)),!c.slice){var p=new Uint8Array(Array.prototype.slice.call(c,0,l));if(n)return p;if(o)return p.buffer;throw new Error("Not implemented")}return c.slice(0,l)},E}();class U{constructor(e,t,s,i){this.configStore=i,this.logger=e,this.storage=t,this.store=s}setHeaders(e,s,i=!1){const n=this.storage.getLocalItem("visionSession"),a=t(n.session_id,p);e.setRequestHeader("App-Id",this.store.getState().app_id),e.setRequestHeader("Authorization",a),e.setRequestHeader("Session-Id",n.session_id),e.setRequestHeader("Suite",this.store.getState().app_suite),e.setRequestHeader("Vauth",a),e.setRequestHeader("Vision-Id",n.vision_id),null!=s&&(e.setRequestHeader("Accept","application/json"),e.setRequestHeader("Content-Type","application/json"),e.setRequestHeader("Event-Count",s.events.length.toString()),this.store.getState().debugMode||"snappy"!==this.configStore.getState().compression||e.setRequestHeader("Content-Encoding","snappy"),i&&"string"==typeof s.events[0].media_session_id&&(e.setRequestHeader("Event-Type",s.events[0].event_name),e.setRequestHeader("Media-Session-Id",s.events[0].media_session_id)))}postEvents(e,t=!1,s=!0){if(0===e.events.length)return;const n=new XMLHttpRequest;n.onreadystatechange=()=>{if(4!==n.readyState)return;const i=n.status>=400&&n.status<=500;i&&s?this.postEvents(e,t,!1):i&&this.logger.log(n.statusText,"Error")},n.open("POST",`${this.store.getState().url.replace(/\/+$/,"")}/${t?"media":"event"}`,!0),n.withCredentials=!0,this.setHeaders(n,e,t);const a=this.store.getState().debugMode||"snappy"!==this.configStore.getState().compression?JSON.stringify(e):new Blob([L.compress(i(JSON.stringify(e)))],{type:"text/plain"});n.send(a)}}class j{constructor(){var e;this._callQueue=[],this._eventBus=new _,this._isInitialized=!1,this._storage=new g,this._store=new f(u);const{pollConfigIntervalSec:t}=h,s=new A(h,{fetchIntervalSec:t,sdk:"vision"}),i=new v(this._store),n=new U(i,this._storage,this._store,s.store);return this._configurator=s,this._logger=i,this._sessionService=new m(this._eventBus,this._storage,this._store,s.store),this._trackingService=new I(this._eventBus,this._storage,this._store,n,s.store),this.constructor._instance=null!==(e=this.constructor._instance)&&void 0!==e?e:this,this.constructor._instance}static _createAdder(e){return this._wrap((function(t,s){const i=this.getInstance(),n=i._storage.getSessionItem(e)||[];n.some((e=>e.id===t))||i._storage.setSessionItem(e,[...n,{id:t,source:s}])}))}static _createSetter(e){return this._wrap((function(t){this.getInstance()._storage.setSessionItem(e,t)}))}static _createUnsetter(e,t){return this._wrap((function(s){const i=this.getInstance(),n=i._storage.getSessionItem(e)||[],a=n.filter((e=>e[t]!==s));n.length!==a.length&&i._storage.setSessionItem(e,a)}))}static _createUnsetterAll(e){return this._wrap((function(){this.getInstance()._storage.removeSessionItem(e)}))}static _wrap(e){return function(...t){const s=this.getInstance();s._isInitialized?e.call(this,...t):s._callQueue.push((()=>e.call(this,...t)))}}static getInstance(){var e;return null!==(e=this._instance)&&void 0!==e?e:new this}static setConfigs(t){if("object"!=typeof t||null==t||!t.app_id||!t.app_suite||!t.url)return void console.error(new TypeError("VISION: config argument is invalid"));const s=this.getInstance();s._configurator.settings.debug=!!t.debugMode;const i=t.url.includes("/v2")?t.app_suite:t.app_id;s._configurator.settings.url=`${t.url.replace(/\/+$/,"")}/config/${i}`,s._store.setState(t),s._isInitialized||(s._storage.setSessionItem("visionPagePreviousUrl",window.document.referrer||"na"),s._storage.setSessionItem("visionPageInstanceId",e()),s._sessionService.run(),s._configurator.fetchConfig(),s._trackingService.run(),s._callQueue.splice(0,s._callQueue.length).forEach((e=>e())),s._isInitialized=!0)}static setForceDisableCollection(){this.getInstance()._storage.setLocalItem("visionForceDisableCollection",!0)}static unsetForceDisableCollection(){const e=this.getInstance();e._storage.removeLocalItem("visionForceDisableCollection"),e._eventBus.publish("client.unset-force-disable-collection")}}D=j,j.addDssId=D._createAdder("visionUserDssId"),j.addGuestId=D._wrap((function(e,t,s,i){!function(e,t,s){const i=["primary","secondary"].indexOf(s),n=e.getState().guestIds.some((e=>e.id===t.id));if(-1===i&&n)return;const a=e.getState().guestIds.map((e=>Object.assign({},e)));i>-1?a[i]=t:a.push(t),e.setState({guestIds:a})}(this.getInstance()._store,{id:e,registered:!!s,source:t},i)})),j.addSubscriptionId=D._wrap((function(e,t){const s=this.getInstance(),i="visionUserSubscriptionId",n=s._storage.getSessionItem(i)||[],[a,r]=null!=t?[t,e]:[e];n.some((e=>e.id===r&&e.source===a))||s._storage.setSessionItem(i,[...n,{id:r,source:a}])})),j.addTest=D._createAdder("visionStateTest"),j.setAccessMethod=D._createSetter("visionUserAccessMethod"),j.setAdvertiserId=D._createSetter("visionDeviceAdvertiserId"),j.setAffiliate=D._createSetter("visionUserAffiliate"),j.setDisneyPlusBundle=D._createSetter("visionUserDisneyPlusBundle"),j.setMvpdName=D._createSetter("visionUserMvpdName"),j.setMvpdShortName=D._createSetter("visionUserMvpdShortName"),j.setPrivacy=D._createSetter("visionStatePrivacy"),j.setEventProperties=D._createSetter("visionCustomEventProperties"),j.setGlobalProperties=D._createSetter("visionCustomGlobalProperties"),j.setSubscriberType=D._createSetter("visionUserSubscriberType"),j.unsetAccessMethod=D._createUnsetterAll("visionUserAccessMethod"),j.unsetAdvertiserId=D._createUnsetterAll("visionDeviceAdvertiserId"),j.unsetAffiliate=D._createUnsetterAll("visionUserAffiliate"),j.unsetAllDssId=D._createUnsetterAll("visionUserDssId"),j.unsetAllSubscriptionId=D._createUnsetterAll("visionUserSubscriptionId"),j.unsetAllTest=D._createUnsetterAll("visionStateTest"),j.unsetDisneyPlusBundle=D._createUnsetterAll("visionUserDisneyPlusBundle"),j.unsetDssId=D._createUnsetter("visionUserDssId","id"),j.unsetMvpdName=D._createUnsetterAll("visionUserMvpdName"),j.unsetMvpdShortName=D._createUnsetterAll("visionUserMvpdShortName"),j.unsetPrivacy=D._createUnsetterAll("visionStatePrivacy"),j.unsetEventProperties=D._createUnsetterAll("visionCustomEventProperties"),j.unsetGlobalProperties=D._createUnsetterAll("visionCustomGlobalProperties"),j.unsetSubscriberType=D._createUnsetterAll("visionUserSubscriberType"),j.unsetSubscriptionId=D._createUnsetter("visionUserSubscriptionId","source"),j.unsetTest=D._createUnsetter("visionStateTest","id"),"undefined"!=typeof window&&(window.VisionConfigurator=A);class z extends j{constructor(){super(...arguments),this._mediaInstances=[],this.track=z._wrap((e=>{if(e=Array.isArray(e)?e:[e],t=e,!Array.isArray(t)||!t.every(a))return void this._logger.log("Missing property event_name. Event not sent","Error");var t;this._trackingService.handleEvents(e);const[s]=e.filter((({event_name:e})=>/^media_/.test(e)));if(!s)return;const i=this._mediaInstances.reduce(((e,{id:t},i)=>-1===e&&t===s.media_id?i:e),-1);if(i>-1){const{instance:e}=this._mediaInstances[i];e.handleEvent(s),"media_stop"===s.event_name&&this._mediaInstances.splice(i,1)}else if(["media_ad_start","media_start"].indexOf(s.event_name)>-1){const e=new n((e=>this._trackingService.postMedia(e)),this._configurator.store);this._mediaInstances.push({id:s.media_id,instance:e}),e.handleEvent(s)}})).bind(z)}}return z}));
